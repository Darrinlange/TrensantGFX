<!DOCTYPE html>
<html>
<!---
	Simple stand alone code editor for graphics demos.

	M A Chatterjee 2017-07-06
 -->
<head>
<!-- HTML header code for trensant-gfx demo. M A Chatterjee 20170525 -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>     <!-- jquery is used for DOM stuff  -->

<!-- bootstrap is used for div management -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>  <!-- not part of graphics library just here for div and layour mgmt -->


<script src="../libs/srcdoc-polyfill.js"></script>  <!-- for setting the iframe attributes                        -->
<script src="../libs/helper-fns.js"></script>	    <!-- misc hacking support like reading cookies, URLs, number scaling -->

<script src="../code_editor/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>  <!-- we're using the ace code editor : learn more here: https://ace.c9.io/   -->

<style>
body {
	width: 80%;
	margin-left:  5%;
	margin-right: 5%;
}

button {
	border-radius: 8px;
}
/* editor control css */
#editor { 
	padding-top: 8px;
    font-size: 11pt;
    font-family: "Courier New", Courier;

    height: 400px;
    width : 100%;

    border-radius: 10px;
}
/* end of code editor */

/* this controls the size and other parameters of the iframe container where the code is rendered*/
.targetFrameCss {
	width: 100%;
	height: 800px;
	border: 1px solid gray;
	border-radius: 10px;
}

</style>

<title>TrensantGFX Live Edit</title>
</head>
<body>
<h2>TGFX Demo Pages</h2>
<p>Use the code editor to experiment with chart.</p>
<br>
<h2 id="titleId"></h2> <!-- dynamically loaded title area-->
<div id="descId">
	Try out the graphics library code in the editor below and hit submit to see the result in the frame below.
</div>
<br>
<div id="editor"></div>
<button id="submitCodeBtn" onclick="submitCode()">Run Code!</button>&nbsp;<button id="copyToClipBoard" onclick="copyToClipboard(editor.getValue())">Copy Code to Clipboard</button>
<br><br>
<iframe class="targetFrameCss" id="targetFrameId"></iframe>

<script type="text/javascript">
	var gSourceCode = "";
	gSourceCode = "<!doctype html>\n<html>\n<body>\nDefault <b>world</b>\n<div id='fpp'></div>\n<script>document.getElementById('fpp').innerHTML = new Date();<\/script>\n</body>\n</html>\n";

	var editor = ace.edit("editor");
    editor.setTheme("ace/theme/mono_industrial"); // the "path" is set by where "ace.js" is
    editor.getSession().setMode("ace/mode/html");
    editor.setOption("tabSize", 4);
    editor.$blockScrolling = Infinity;
    editor.setValue(gSourceCode);
    editor.clearSelection();
    
   	function submitCode() {
		var s = editor.getValue()//"<html><body>Hello, <b>world</b>. "+String(new Date())+"</body></html>"	
		srcDoc.set(document.getElementById("targetFrameId"),s);  // this loads the code from our editor in to the iframe.  The iframe is a complete stand-alone html page.
	}
	// =====================================
	// primitive copy a string to the clipboard function
	function copyToClipboard(data) {  
		var $temp = $("<input>");
		$("body").append($temp);
		$temp.val(data).select();
		document.execCommand("copy");
		$temp.remove();
	}
	// =======================================
	// load file 
	var src = hf.getURLParam("src","./simpleTestLoad.html");

	var xhrRequest = function (url, type, callback) {
		var xhr = new XMLHttpRequest();
		xhr.onload = function () {
		callback(this.responseText);
		};
		xhr.open(type, url);
		xhr.send();
	};

	xhrRequest(src, "GET", function(d){editor.setValue(d); editor.clearSelection(); submitCode();});
	// set up title and description
	document.getElementById("titleId").innerHTML = decodeURIComponent(hf.getURLParam("titleText","Trensant Gfx Tester"));
	document.getElementById("descId").innerHTML  = decodeURIComponent(hf.getURLParam("descText","Try out the graphics library code in the editor below and hit submit to see the result in the frame below."));


</script>

</body>
</html>
